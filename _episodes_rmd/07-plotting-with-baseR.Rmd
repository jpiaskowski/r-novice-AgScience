---
title: Exploratory Data Analysis with Base Plotting in R
teaching: 15
exercises: 10
questions:
- "How can I use R plotting features in base R to explore data?"
objectives:
- "Describe best options for making plots in base R and controle features for that."
keypoints:
- "the function `plot()` produces different results depending on the type of object it operates on"
- "search 'par' for plotting options"
- "...."
source: Rmd
---

## Exploratory Data Analysis

Data visualisation is one of the R's strengths. R can produce very quick plots for a snapshot of the data, and it can also be used to produce publication quality graphs. 
There are some amazing plotting packages written - ggplot and a large ecosystem of ggplot extensions and so much more. 

## Univariate plots

The `plot()` is the most common plot command, possibly because it is very flexible. Let's start by creating a vector using the function `rnorm()` which generates random numbers from the normal distribution assuming a mean of 0 and standard deviation of 1. 

```{r}
myvec <- rnorm(100)
```

When calling the plot command for one numeric vector, it will plot the index, or the position of each item in the vector versus its actual value:

```{r}
plot(myvec)
```

R functions can be passed within `plot()` call: 
```{r}
plot(sort(myvec))
```
R executed started with the innermost function first and the the outermost function. It's important to note that this function by itself did not reorder "myvec". Reordering occurred for this plotting function call only. You check by by looking at myvec:

```{r}
myvec
```

We also view these data as a histogram: 
```{r}
hist(myvec)
```
 We can also alter the breakpoints for the histograms bins:
 
```{r}
mybreaks <- seq(from = -3, to = 4, by = 0.5)
hist(myvec, breaks = mybreaks)
```
 
We can also create a density plot with a little more coding: 


```{r}
plot(density(myvec))
```
If you want a smoother plot, there's an argument within `density()` for that:
```{r}
plot(density(myvec, adjust = 3))
```

You may have noticed that the axis labels are being generated. We can adjust this, along with many other aspects of these plots. 
 
**Tip**: if you search for `?plot` in R's help functions, you'll be disappointed by how little documentation is returned. As it turns out `plot()` is a generic command that produces very different results dependong on the type of object it is acting on. To search for help for using the function `plot()` on a data frame or on vectors, search for `?par`. The information provided there also work for `barplot()`, `boxplot()`, `hist()`, density plots and other base plotting functions. The documentation for `barplot()`, `boxplot()`, and `hist()` is more extensive, thankfully. 

```{r}
hist(myvec, breaks = 10, col = "springgreen", main = "My title", xlab = "frequency", ylab = "value", col.lab = "navy", cex.axis = 1.5, cex.main = 1.5, cex.lab = 1.5)
```

Let's break down what happened. The parameter "cex" is short for "character expansion factor" and is the amount of increase the size of an item. It's a magnification level - so 1.5 increases things by 1.5 times. The argument "cex.axis" increases the axis tick labels, "cex.main" increase the title size, and "cex.lab" increases the axis labels. "cex" by itself magnifies points. The color of the histogram was set, as well at the axis text. There are many, many more plotting options. With great power, comes great coding effort. 

There are also function for generatig a quantile-quantile (qq) plot, which is handy for diagnosing departures from normality.  
```{r}
qqnorm(myvec, col = "violetred")
qqline(myvec)
```

Even using a function like `rnorm`, there is still variation from the expected distribution! 

You may also have noticed there's some unusual colors being used in these examples. R has hundreds of colors available for plotting and create any color given either the hexadecimal representation or RGB (red, blue, green) numbers. You can view the standard colors by running `demo("colors")` in the R console. 

## Multivariate plots

For this, let's load some data first; 
```{r}
hay <- read.csv("data/historical_hay_data.csv")
hessian_fly <- read.csv("data/hessian_fly_data.csv")
carbon <- read.csv("data/CO2_study.csv")
```

Plots between 2 variables, x-y plots, are great ways to get a quick look at the relationship between two variables. First, let's filter the data for only data from Idaho. Then, we can plot yield over time. 

```{r}
hay_idaho <- hay[hay$state == "Idaho", ]
plot(hay_idaho$year, hay_idaho$yield)
```
The default labels are a little annoying. Let's also try a different plotting symbol:

```{r}
plot(hay_idaho$year, hay_idaho$yield, ylab = "yield", xlab = "year", pch = 21, col = "gray20", bg = "chartreuse")
```

Barplots can be useful, but they can also be [misleading](https://simplystatistics.org/2019/02/21/dynamite-plots-must-die/). Boxplots can be a useful alternative. Let's try both. Technically, they don't need color, but for workshop materials, it's nice to break away from a monochrome palette.  

```{r}

hay_pnw <- hay[hay$state %in% c("Idaho", "Washington", "Oregon"), ]

boxplot(hay_pnw$acres ~ hay_pnw$state, col = c("red", "green", "yellow"))
```

Whoa, that's weird. This happened because "hay$state" is a factor and still has other levels. This can be solved by converting it to type character.

```{r}
hay_pnw$state <- as.character(hay_pnw$state)
boxplot(hay_pnw$acres ~ hay_pnw$state, col = c("red", "green", "yellow"))
```
Yield is expressed in tons per acre, so Idaho really is on top of PNW hay production! What does it look like across states? The `coplot()` function is used for that. Let's also start using the `with()` statement to avoid constantly having name what R object to use. The function `with()` instructs R to use that object. It works by first naming which object to use, and then is followed by whatever function will call that object. 
```{r}
with(hay_pnw, coplot(yield ~ year | state))
```

They can also be combined into a single plot and colored by state:
```{r}
plot(hay_pnw$year, hay_pnw$yield) # col = c("red", "green","yellow")[hay_pnw$state])
```


Legend

```{r}
x<-1:10; y1=x*x; y2=2*y1
plot(x, y1, type="b", pch=19, col="red", xlab="x", ylab="y")
# Add a line
lines(x, y2, pch=18, col="blue", type="b", lty=2)
# Add a legend
legend(1, 95, legend=c("Line 1", "Line 2"),
       col=c("red", "blue"), lty=1:2, cex=0.8)
```


Lines
abline()

Text
special characters
# main = expression(paste("Sampled values, ", mu, "=5, ", sigma, "=1")

## How do you find help on plot options?

## Plot methods for other objects



