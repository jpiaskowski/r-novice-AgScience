---
title: Writing Data
teaching: 10
exercises: 10
questions:
- "How can I save plots and data created in R?"
objectives:
- "To be able to write out plots and data from R."
keypoints:
- "Save plots from RStudio using the 'Export' button."
- "Use `write.table` to save tabular data."
source: Rmd
---

```{r eval=FALSE, include=FALSE}
source("../bin/chunk-options.R")
knitr_fig_path("11-")
# Silently load in the data so the rest of the lesson works
library("ggplot2")
gapminder <- read.csv("data/gapminder_data.csv", header=TRUE)
# Temporarily create a cleaned-data directory so that the writing examples work
# The students should have created this in topic 2.
dir.create("cleaned-data")
```

## Writing data

At some point, you'll also want to write out data from R.

We can use the `write.csv()` function for this, which is
very similar to `read.csv()` from before. This is a wrapper for 
`read.table()` with specific default arguments. 

Let's create a data-cleaning script, for this analysis, we
only want to focus on the gapminder data for Australia:

```{r}
aust_subset <- gapminder[gapminder$country == "Australia",]

write.csv(aust_subset,
  file="cleaned-data/gapminder-aus.csv",
  row.names = F)
```

> ## Challenge 1
>
> Write a data-cleaning script file that subsets the gapminder
> data to include only data points collected since 1990.
>
> Use this script to write out the new subset to a file
> in the `cleaned-data/` directory.
> > ## Solution to challenge 2
> >
> > ```{r, eval = FALSE}
> > write.table(
> >   gapminder[gapminder$year > 1990, ],
> >   file = "cleaned-data/gapminder-after1990.csv",
> >   sep = ",", quote = FALSE, row.names = FALSE
> > )
> > ```
> {: .solution}
{: .challenge}

```{r, echo=FALSE}
# We remove after rendering the lesson, because we don't want this in the lesson
# repository
unlink("cleaned-data", recursive=TRUE)
```

## Saving plots

You can save a plot from within RStudio using the 'Export' button
in the 'Plot' window. This will give you the option of saving as a
.pdf or as .png, .jpg or other image formats.

Sometimes you will want to save plots without creating them in the
'Plot' window first. Perhaps you want to make a pdf document with
multiple pages: each one a different plot, for example. Or perhaps
you're looping through multiple subsets of a file, plotting data from
each subset, and you want to save each plot, but obviously can't stop
the loop to click 'Export' for each one.

In this case you can use a more flexible approach. The function
`png()` creates a new pdf device. You can control the size and resolution
using the arguments to this function.

```{r, eval=FALSE}
png("Life_Exp_vs_time.pdf", width=12, height=4)
ggplot(data=gapminder, aes(x=year, y=lifeExp, colour=country)) +
  geom_line() +
  theme(legend.position = "none")

# You then have to make sure to turn off the pdf device!

dev.off()
```

Open up this document and have a look.

> ## Challenge 2
>
> Output a plot as a jpeg
> (hint: check the help files)
> 
> > ## Solution to challenge 1
> >
> > ```{r, eval = FALSE}
> > jpeg("Life_Exp_vs_time.pdf", width = 12, height = 4)
> > 
> >   
> >   
> > 
> > 
> > dev.off()
> > ```
> {: .solution}
{: .challenge}

The commands `jpeg`, `png` etc. are used similarly to produce
documents in different formats.